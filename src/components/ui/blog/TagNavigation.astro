---
// Tags for the Blog and post pages

import Badge from '../Badge.astro'
import { getCollection } from 'astro:content'

type Props = { lang: 'cs' | 'en' }
const { lang } = Astro.props

const posts = await getCollection('blog', ({ id, data }) =>
  id.startsWith(`${lang}/blog/`) && !data.draft
)

const tags = [...new Set(posts.flatMap((p) => p.data.tags ?? []))].sort()

const currentPath = new URL(Astro.request.url).pathname
const segments = currentPath.split('/').filter(Boolean)
const currentTagRaw = segments[segments.length - 1] || ''
const currentTag = decodeURIComponent(currentTagRaw)

const isAllActive = currentPath === `/${lang}/blog` || currentPath === `/${lang}/blog/`
---

<div class="tags">
  <Badge
    link={`/${lang}/blog`}
    name="All"
    type={isAllActive ? 'primary' : 'neutral'}
  />

  {tags.map((tag) => (
    <Badge
      link={`/${lang}/blog/tags/${encodeURIComponent(tag)}`}
      name={tag}
      type={currentTag === tag ? 'primary' : 'neutral'}
    />
  ))}
</div>
