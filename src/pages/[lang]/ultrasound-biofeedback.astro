---
import Layout from '../../layouts/PostLayout.astro'
import { getCollection, render } from 'astro:content'

const LANG_RE = /\.(cs|en)$/

function getLangFromEntryId(id: string) {
  const m = id.match(LANG_RE)
  return m ? (m[1] as 'cs' | 'en') : null
}

function getBaseSlug(id: string) {
  return id.replace(LANG_RE, '') // blog1.en -> blog1
}

export async function getStaticPaths() {
  const entries = await getCollection('blog')

  return entries
    .map((entry) => {
      const lang = getLangFromEntryId(entry.id)
      if (!lang) return null

      return {
        params: { lang, id: getBaseSlug(entry.id) }, // /en/blog/blog1
        props: { entry },
      }
    })
    .filter(Boolean)
}

const { entry } = Astro.props
const { Content } = await render(entry)

// This is your “current language” for this page instance:
const lang = Astro.params.lang === 'en' ? 'en' : 'cs'
---
<Layout frontmatter={entry.data} lang={lang}>
  <Content />
</Layout>
